<!DOCTYPE html>
<html lang="vi">
<head>
    <!--
      Baby.html ‚Äî Trang qu√† t·∫∑ng 20/10 üíå
      Phi√™n b·∫£n n√¢ng c·∫•p cho nhi·ªÅu ng∆∞·ªùi (Chan & Linh)
    -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu√† T·∫∑ng 20/10 ƒê·∫∑c Bi·ªát üíå</title>
    <!-- T·∫£i Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400..700&display=swap" rel="stylesheet">
    
    <!-- Link ƒë·∫øn file CSS ri√™ng -->
    <link rel="stylesheet" href="styles.css">
    
</head>
<body>

    <!-- ========================================================================= -->
    <!-- PH·∫¶N HTML STRUCTURE (Kh√¥ng thay ƒë·ªïi) -->
    <!-- ========================================================================= -->

    <!-- 1. Giai ƒëo·∫°n 1: M√†n h√¨nh Prompt -->
    <div id="stage1" class="stage active">
        <div id="stage1-content">
            <p id="prompt-text">
                T·ªõ c√≥ m√≥n qu√† cho c·∫≠u n√® <span class="emoji" aria-label="l√° th∆∞">üíå</span>
            </p>
        </div>
    </div>

    <!-- 2. Giai ƒëo·∫°n 2: Slideshow v√† Hi·ªáu ·ª©ng -->
    <div id="stage2" class="stage">
        <!-- JavaScript s·∫Ω t·ª± ƒë·ªông ch√®n ·∫£nh v√†o ƒë√¢y -->
        <div id="slideshow-container">
        </div>
    </div>

    <!-- 3. Giai ƒëo·∫°n 3: L·ªùi Ch√∫c Cu·ªëi c√πng -->
    <div id="stage3" class="stage">
        <div id="final-message-box">
            <div id="typing-area">
                <!-- N·ªôi dung s·∫Ω ƒë∆∞·ª£c ch√®n b·∫±ng JS -->
            </div>
            <p class="signature">‚Äî t·ª´ H√† Qu·ªëc Kh√°nh ‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</p>
        </div>
    </div>

    <!-- Nh·∫°c n·ªÅn -->
    <audio id="bgsound" loop>
        <source src="Anhdanhroinguoiyeunay.mp3" type="audio/mp3">
    </audio>

    <!-- ========================================================================= -->
    <!-- PH·∫¶N JAVASCRIPT LOGIC (ƒê√É C·∫¨P NH·∫¨T) -->
    <!-- ========================================================================= -->
    <script>
        // --- B∆Ø·ªöC 1: "DATABASE" CH·ª®A TH√îNG TIN T·ª™NG NG∆Ø·ªúI ---
        const dataNguoiNhan = {
            
            // --- D·ªØ li·ªáu c·ªßa Chan (Ng∆∞·ªùi y√™u) ---
            "chan": { // Link s·∫Ω l√†: ?nguoi=chan
                ten: "B√© Chan",
                nguoiGui: "H√† Qu·ªëc Kh√°nh",
                chuKy: "‚Äî t·ª´ H√† Qu·ªëc Kh√°nh ‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è",
                prompt: "T·ªõ c√≥ m√≥n qu√† cho c·∫≠u n√® <span class=\"emoji\" aria-label=\"l√° th∆∞\">üíå</span>",
                loiChuc: [
                    "Ch√∫c c·∫≠u 20/10 th·∫≠t r·∫°ng r·ª°, lung linh üíê",
                    "ng√†y c√†ng xinh ƒë·∫πp h∆°n n·ªØa v√† nh·ªõ c∆∞·ªùi nhi·ªÅu h∆°n nhaaa.",
                    "T·ª´ khi c·∫≠u xu·∫•t hi·ªán, cu·ªôc s·ªëng c·ªßa t·ªõ c√≥ th√™m nhi·ªÅu m√†u s·∫Øc h∆°n  üå∏",
                    "C·∫£m ∆°n c·∫≠u ƒë√£ b∆∞·ªõc ƒë·∫øn b√™n t·ªõ!"
                ],
                danhSachAnh: [
                    "·∫¢nh/Chan/img1.jpg",
                    "·∫¢nh/Chan/img2.jpg",
                    "·∫¢nh/Chan/img3.jpg",
                    "·∫¢nh/Chan/img4.jpg",
                    "·∫¢nh/Chan/img5.jpg",
                    "·∫¢nh/Chan/img6.jpg",
                    "·∫¢nh/Chan/img7.jpg",
                    "·∫¢nh/Chan/img8.jpg",
                    "·∫¢nh/Chan/img9.jpg"
                ]
            },
            "ngoc": { // Link s·∫Ω l√†: ?nguoi=ngoc
                ten: "B√© Ng·ªçc",
                nguoiGui: "L√™ VƒÉn Ng·ªçc",
                chuKy: "‚Äî t·ª´ L√™ VƒÉn Ng·ªçc ‚ù§Ô∏è",
                prompt: "Anh c√≥ m√≥n qu√† cho em <span class=\"emoji\" aria-label=\"l√° th∆∞\">üíå</span>",
                loiChuc: [
                    "Ch√∫c em 20/10 th·∫≠t r·∫°ng r·ª°, lung linh üíê",
                    "Em m√£i l√† b√¥ng hoa xinh ƒë·∫πp r·∫°ng ng·ªùi trong cu·ªôc ƒë·ªùi anh.",
                    "Anh y√™u em  üå∏",
                    "C·∫£m ∆°n em ƒë√£ xu·∫•t hi·ªán b√™n anh!"
                ],
                danhSachAnh: [
                    "·∫¢nh/nyNgoc/nyngoc1.jpg",
                ]
            },
            
            // --- D·ªØ li·ªáu c·ªßa Linh (Em g√°i) ---
            "linh": { // Link s·∫Ω l√†: ?nguoi=linh
                ten: "Em g√°i Linh",
                nguoiGui: "Anh Kh√°nh",
                chuKy: "‚Äî t·ª´ Anh Kh√°nh ‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è",
                prompt: "Anh c√≥ m√≥n qu√† cho em n√® <span class=\"emoji\" aria-label=\"l√° th∆∞\">üíå</span>",
                loiChuc: [
                    "Ch√∫c em g√°i 20/10 vui v·∫ª, l·∫°c quan v√† ng√†y c√†ng xinh ƒë·∫πp nhaaaa!",
                    "h·ªçc gi·ªèi, ƒë·∫°t ƒë∆∞·ª£c k·∫øt qu·∫£ mong ∆∞·ªõc trong k·ª≥",
                    "t·ªët nghi·ªáp THPT v√† v√†o ƒë∆∞·ª£c ƒë·∫°i h·ªçc mong ∆∞·ªõc",
                    "M√£i l√† c√¥ em g√°i ƒë√°ng y√™u c·ªßa anh nha! üíñ"
                ],
                danhSachAnh: [
                    "·∫¢nh/Linh/Linh1.jpg",
                    "·∫¢nh/Linh/Linh2.jpg",
                    "·∫¢nh/Linh/Linh3.jpg",
                    "·∫¢nh/Linh/Linh 4.jpg"
                ]
            },
            "thu": { // Link s·∫Ω l√†: ?nguoi=thu
                ten: "ban Thu",
                nguoiGui: "Kh√°nh",
                chuKy: "‚Äî t·ª´ Kh√°nh ‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è",
                prompt: "T·ªõ c√≥ m√≥n qu√† cho c·∫≠u n√® <span class=\"emoji\" aria-label=\"l√° th∆∞\">üíå</span>",
                loiChuc: [
                    "Ch√∫c c·∫≠u 20/10 th·∫≠t r·∫°ng r·ª°, lung linh üíê",
                    "ng√†y c√†ng xinh ƒë·∫πp h∆°n n·ªØa v√† nh·ªõ c∆∞·ªùi nhi·ªÅu h∆°n nhaaa.",
                    "Ch√∫c c·∫≠u ƒë·∫°t ƒë∆∞·ª£c aim 7.5 ielts nh√©  üå∏",
                    "C·∫≠u lu√¥n l√† b·∫°n t·ªët c·ªßa t·ªõ!"
                ],
                danhSachAnh: [
                    "·∫¢nh/Thu/thu1.jpg",
                    "·∫¢nh/Thu/thu2.jpg",
                    "·∫¢nh/Thu/thu3.jpg",
                    "·∫¢nh/Thu/thu4.jpg",
                    "·∫¢nh/Thu/thu5.jpg",
                    "·∫¢nh/Thu/thu6.jpg"
                ]
            },
            "mo": { // Link s·∫Ω l√†: ?nguoi=mo
                ten: "ban Mo",
                nguoiGui: "Kh√°nh",
                chuKy: "‚Äî t·ª´ Kh√°nh ‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è",
                prompt: "Ch√°u c√≥ m√≥n qu√† cho m·ª£ n√® <span class=\"emoji\" aria-label=\"l√° th∆∞\">üíå</span>",
                loiChuc: [
                    "Ch√∫c m·ª£ 20/10 th·∫≠t r·∫°ng r·ª°, lung linh üíê",
                    "ng√†y c√†ng xinh ƒë·∫πp h∆°n n·ªØa v√† l√∫c n√†o c≈©ng lu√¥n m·ªâm c∆∞·ªùi",
                    "Ch√∫c m·ª£ v∆∞·ª£t qua v·∫•t v·∫£ nu√¥i em Chi l·ªõn  üå∏",
                    "M·ª£ lu√¥n m·ª£ tuy·ªát v·ªùi c·ªßa ch√°u!"
                ],
                danhSachAnh: [
                    "·∫¢nh/moHuong/mo1.jpg",
                    "·∫¢nh/moHuong/mo2.jpg",
                    "·∫¢nh/moHuong/mo3.jpg",
                    "·∫¢nh/moHuong/mo4.jpg",
                    "·∫¢nh/moHuong/mo5.jpg",
                    "·∫¢nh/moHuong/mo6.jpg"
                ]
            },

        };


        // --- B∆Ø·ªöC 2: L·∫§Y TH√îNG TIN NG∆Ø·ªúI NH·∫¨N T·ª™ URL ---
        const urlParams = new URLSearchParams(window.location.search);
        const nguoiKey = urlParams.get('nguoi'); 
        
        // Ch·ªçn data, n·∫øu kh√¥ng c√≥ key tr√™n URL th√¨ d√πng data c·ªßa "chan" l√†m m·∫∑c ƒë·ªãnh
        const thongTin = dataNguoiNhan[nguoiKey] || dataNguoiNhan['chan'];
        
        const finalMessage = thongTin.loiChuc;
        const anhCaNhan = thongTin.danhSachAnh;
        const promptText = thongTin.prompt || "T·ªõ c√≥ m√≥n qu√† cho c·∫≠u n√® <span class=\"emoji\" aria-label=\"l√° th∆∞\">üíå</span>";
        const fallingImages = [ ...anhCaNhan, '·∫¢nh/q3.png', '·∫¢nh/t2.png', '·∫¢nh/t5.png' ];

        // --- B∆Ø·ªöC 3: C√ÅC BI·∫æN V√Ä H√ÄM C∆† B·∫¢N ---
        const stage1 = document.getElementById('stage1');
        const stage2 = document.getElementById('stage2');
        const stage3 = document.getElementById('stage3');
        const stage1Content = document.getElementById('stage1-content');
        const audio = document.getElementById('bgsound');
        const slideshowContainer = document.getElementById('slideshow-container');
        const promptTextElem = document.getElementById('prompt-text');
        const signatureElem = document.querySelector('.signature');

        // G√°n prompt c√° nh√¢n h√≥a v√†o ph·∫ßn t·ª≠ #prompt-text
        if (promptTextElem) {
            promptTextElem.innerHTML = promptText;
        }

        // G√°n ch·ªØ k√Ω c√° nh√¢n h√≥a v√†o ph·∫ßn t·ª≠ .signature
        if (signatureElem && thongTin.chuKy) {
            signatureElem.textContent = thongTin.chuKy;
        }

        let slides; 
        let currentSlide = 0;
        let particleInterval;
        
        function setStage(stageId) {
            document.querySelectorAll('.stage').forEach(stage => stage.classList.remove('active'));
            document.getElementById(stageId).classList.add('active');
        }

        const petalEmojis = ['üå∏', 'üåπ', 'üíñ', '‚ú®'];
        function createPetal() {
            const petal = document.createElement('div');
            petal.classList.add('petal');
            const emoji = petalEmojis[Math.floor(Math.random() * petalEmojis.length)];
            petal.innerHTML = `<span class="petal-icon" style="font-size: ${Math.random() * 15 + 15}px">${emoji}</span>`;
            petal.style.left = `${Math.random() * 100}vw`;
            petal.style.animationDuration = `${Math.random() * 10 + 8}s`; 
            petal.style.animationDelay = `${Math.random() * 5}s`; 
            petal.style.setProperty('--sway', (Math.random() * 2 - 1).toFixed(2)); 
            document.body.appendChild(petal);
            setTimeout(() => { petal.remove(); }, 20000); 
        }

        function startParticleEffect() {
            if (!particleInterval) particleInterval = setInterval(createPetal, 300); 
        }

        function stopParticleEffect() {
            clearInterval(particleInterval);
            particleInterval = null;
            document.querySelectorAll('.petal').forEach(p => {
                p.style.transition = 'opacity 1s';
                p.style.opacity = '0';
                setTimeout(() => p.remove(), 1000);
            });
        }

        function taoSlideshowDong() {
            slideshowContainer.innerHTML = ''; 
            if (!anhCaNhan || anhCaNhan.length === 0) {
                slideshowContainer.innerHTML = "<p>L·ªói: Kh√¥ng t√¨m th·∫•y ·∫£nh.</p>";
                return;
            }
            anhCaNhan.forEach((src, index) => {
                const slide = document.createElement('div');
                slide.className = 'slide' + (index === 0 ? ' current' : '');
                slide.innerHTML = `<img src="${src}" alt="·∫¢nh ${index + 1}">`;
                slideshowContainer.appendChild(slide);
            });
            slideshowContainer.addEventListener('click', nextSlide);
            slideshowContainer.style.cursor = 'pointer';
        }

        function showSlide(index) {
            slides.forEach((slide, i) => {
                slide.classList.toggle('current', i === index);
            });
        }

        function nextSlide() {
            currentSlide++;
            if (currentSlide >= slides.length) {
                stopParticleEffect();
                handleStage3Reveal();
            } else {
                showSlide(currentSlide);
            }
        }

        async function typeLine(lineElement, text) {
            return new Promise(resolve => {
                let i = 0;
                const typingTimer = setInterval(() => {
                    if (i < text.length) {
                        lineElement.textContent += text.charAt(i++);
                    } else {
                        clearInterval(typingTimer);
                        lineElement.style.borderRight = 'none';
                        resolve();
                    }
                }, 70);
            });
        }

        async function startTypingEffect() {
            const typingArea = document.getElementById('typing-area');
            for (let i = 0; i < finalMessage.length; i++) {
                const lineElement = document.createElement('p');
                lineElement.className = 'message-line';
                typingArea.appendChild(lineElement);
                await typeLine(lineElement, finalMessage[i]);
                if (i < finalMessage.length - 1) {
                    lineElement.style.borderRight = '.15em solid var(--primary-pink)';
                    await new Promise(r => setTimeout(r, 1000));
                    lineElement.style.borderRight = 'none';
                }
            }
        }

        function handleStage3Reveal() {
            setStage('stage3');
            startTypingEffect();
        }

        function handleInitialClick() {
            audio.play().catch(e => console.error('Audio playback failed:', e));
            setStage('stage2');
            startParticleEffect();
            taoSlideshowDong();
            slides = document.querySelectorAll('#slideshow-container .slide');
            stage1Content.removeEventListener('click', handleInitialClick);
        }
        
        stage1Content.addEventListener('click', handleInitialClick);

        // =============================
        // HI·ªÜU ·ª®NG ·∫¢NH R∆†I C√Å NH√ÇN H√ìA
        // =============================
        // fallingImages: M·∫£ng ch·ª©a c√°c ƒë∆∞·ªùng d·∫´n ·∫£nh s·∫Ω r∆°i (c√° nh√¢n h√≥a cho t·ª´ng ng∆∞·ªùi)
        // B·∫°n c√≥ th·ªÉ ƒë·ªÉ 1 ·∫£nh duy nh·∫•t ho·∫∑c nhi·ªÅu ·∫£nh, mi·ªÖn l√† ƒë√∫ng ƒë∆∞·ªùng d·∫´n
        // V√≠ d·ª•: ['·∫¢nh/Chan/img1.jpg'] ho·∫∑c ['·∫¢nh/Chan/img1.jpg', '·∫¢nh/Chan/img2.jpg']

        // H√†m t·∫°o nhi·ªÅu ·∫£nh r∆°i m·ªói l·∫ßn (quantity: s·ªë l∆∞·ª£ng ·∫£nh r∆°i/l·∫ßn)
        function createFallingLetter(quantity = 3) {
            for (let i = 0; i < quantity; i++) {
                // T·∫°o 1 th·∫ª <img> cho m·ªói ·∫£nh r∆°i
                const letter = document.createElement('img');
                // Ch·ªçn ng·∫´u nhi√™n 1 ·∫£nh trong m·∫£ng fallingImages
                const randomImage = fallingImages[Math.floor(Math.random() * fallingImages.length)];
                letter.src = randomImage;
                letter.classList.add('falling-letter');
                // ƒê·∫∑t v·ªã tr√≠ ngang ng·∫´u nhi√™n tr√™n m√†n h√¨nh
                letter.style.left = Math.random() * (window.innerWidth - 50) + 'px';
                document.body.appendChild(letter);
                // Sau 8 gi√¢y t·ª± ƒë·ªông x√≥a ·∫£nh r∆°i kh·ªèi DOM ƒë·ªÉ tr√°nh ƒë·∫ßy b·ªô nh·ªõ
                setTimeout(() => { letter.remove(); }, 8000);
            }
        }

        // T·ª± ƒë·ªông t·∫°o hi·ªáu ·ª©ng ·∫£nh r∆°i li√™n t·ª•c:
        // - M·ªói 0.6 gi√¢y s·∫Ω t·∫°o ra 3 ·∫£nh r∆°i m·ªõi
        // - Mu·ªën tƒÉng/gi·∫£m s·ªë l∆∞·ª£ng ·∫£nh r∆°i: ch·ªânh s·ªë 3 (s·ªë l∆∞·ª£ng) ho·∫∑c 600 (t·ªëc ƒë·ªô)
        setInterval(() => createFallingLetter(3), 600);
        // =============================
        // H·∫æT HI·ªÜU ·ª®NG ·∫¢NH R∆†I C√Å NH√ÇN H√ìA
        // =============================
    </script>
</body>
</html>
