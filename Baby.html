<!DOCTYPE html>
<html lang="vi">
<head>
    <!--
      Baby.html ‚Äî Trang qu√† t·∫∑ng 20/10 üíå
      C·∫•u tr√∫c g·ªìm 3 stage:
        1) Stage 1: Prompt m·ªü ƒë·∫ßu (click ƒë·ªÉ b·∫Øt ƒë·∫ßu)
        2) Stage 2: Slideshow ·∫£nh (click ƒë·ªÉ chuy·ªÉn ·∫£nh)
        3) Stage 3: L·ªùi ch√∫c (hi·ªáu ·ª©ng g√µ ch·ªØ)
      Ghi ch√∫: M·ªçi style xem trong styles.css (c√≥ m·ª•c l·ª•c r√µ r√†ng)
    -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu√† T·∫∑ng 20/10 ƒê·∫∑c Bi·ªát üíå</title>
    <!-- T·∫£i Google Fonts: Playfair Display (cho ti√™u ƒë·ªÅ) v√† Poppins (cho n·ªôi dung) -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400..700&display=swap" rel="stylesheet">
    
    <!-- Link ƒë·∫øn file CSS ri√™ng -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- Preload ·∫£nh ƒë·ªÉ t·∫£i tr∆∞·ªõc, gi·∫£m th·ªùi gian ch·ªù -->
    <link rel="preload" as="image" href="·∫¢nh/img1.jpg">
    <link rel="preload" as="image" href="·∫¢nh/img2.jpg">
    <link rel="preload" as="image" href="·∫¢nh/img3.jpg">
    <link rel="preload" as="image" href="·∫¢nh/img4.jpg">
    <link rel="preload" as="image" href="·∫¢nh/img5.jpg">
    
</head>
<body>

    <!-- ========================================================================= -->
    <!-- PH·∫¶N HTML STRUCTURE -->
    <!-- ========================================================================= -->

    <!-- 1. Giai ƒëo·∫°n 1: M√†n h√¨nh Prompt -->
    <div id="stage1" class="stage active">
        <div id="stage1-content">
            <p id="prompt-text">
                T·ªõ c√≥ m√≥n qu√† cho c·∫≠u n√® <span class="emoji" aria-label="l√° th∆∞">üíå</span>
            </p>
        </div>
    </div>

    <!-- 2. Giai ƒëo·∫°n 2: Slideshow v√† Hi·ªáu ·ª©ng -->
    <div id="stage2" class="stage">
        <div id="slideshow-container">
            <div class="slide current"><img src="·∫¢nh/img1.jpg" alt="·∫¢nh 1"></div>
            <div class="slide"><img src="·∫¢nh/img2.jpg" alt="·∫¢nh 2"></div>
            <div class="slide"><img src="·∫¢nh/img3.jpg" alt="·∫¢nh 3"></div>
            <div class="slide"><img src="·∫¢nh/img4.jpg" alt="·∫¢nh 4"></div>
            <div class="slide"><img src="·∫¢nh/img5.jpg" alt="·∫¢nh 5"></div>
            <div class="slide"><img src="·∫¢nh/img6.jpg" alt="·∫¢nh 6"></div>
            <div class="slide"><img src="·∫¢nh/img7.jpg" alt="·∫¢nh 7"></div>
            <div class="slide"><img src="·∫¢nh/img8.jpg" alt="·∫¢nh 8"></div>
            <div class="slide"><img src="·∫¢nh/img9.jpg" alt="·∫¢nh 9"></div>   
        </div>
    </div>

    <!-- 3. Giai ƒëo·∫°n 3: L·ªùi Ch√∫c Cu·ªëi c√πng -->
    <div id="stage3" class="stage">
        <div id="final-message-box">
            <div id="typing-area">
                <!-- N·ªôi dung s·∫Ω ƒë∆∞·ª£c ch√®n b·∫±ng JS -->
            </div>
            <p class="signature">‚Äî t·ª´ H√† Qu·ªëc Kh√°nh ‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</p>
        </div>
    </div>

    <!-- Nh·∫°c n·ªÅn (S·∫Ω ƒë∆∞·ª£c ph√°t b·∫±ng JS sau khi click) -->
    <audio id="bgsound" loop>
        <!-- THAY TH·∫æ D√íNG N√ÄY B·∫∞NG LINK MP3 C·ª¶A B·∫†N -->
        <source src="Anhdanhroinguoiyeunay.mp3" type="audio/mp3">
    </audio>

    <!-- ========================================================================= -->
    <!-- PH·∫¶N JAVASCRIPT LOGIC -->
    <!-- S·ª≠ d·ª•ng JS ƒë·ªÉ ƒëi·ªÅu khi·ªÉn t∆∞∆°ng t√°c v√† th·ªùi gian -->
    <!-- ========================================================================= -->
    <script>
        const stage1 = document.getElementById('stage1');
        const stage2 = document.getElementById('stage2');
        const stage3 = document.getElementById('stage3');
        const stage1Content = document.getElementById('stage1-content');
        const audio = document.getElementById('bgsound');
        const slides = document.querySelectorAll('#slideshow-container .slide');
        let currentSlide = 0;
        let particleInterval;

        // L·ªùi ch√∫c cu·ªëi c√πng
        const finalMessage = [
            "Ch√∫c c·∫≠u 20/10 th·∫≠t r·∫°ng r·ª°, lung linh üíê",
            "ng√†y c√†ng xinh ƒë·∫πp h∆°n n·ªØa v√† nh·ªõ c∆∞·ªùi nhi·ªÅu h∆°n nhaaa.",
            "T·ª´ khi c·∫≠u xu·∫•t hi·ªán, cu·ªôc s·ªëng c·ªßa t·ªõ c√≥ th√™m nhi·ªÅu m√†u s·∫Øc h∆°n  üå∏",
            "C·∫£m ∆°n c·∫≠u ƒë√£ b∆∞·ªõc ƒë·∫øn b√™n t·ªõ!"
        ];

        /* --- H√†m X·ª≠ l√Ω Chuy·ªÉn Stage (Stage Manager) --- */
        function setStage(stageId) {
            document.querySelectorAll('.stage').forEach(stage => {
                stage.classList.remove('active');
            });
            document.getElementById(stageId).classList.add('active');
        }

        /* --- Hi·ªáu ·ª©ng Hoa R∆°i (Petal Particles) --- */
        const petalEmojis = ['üå∏', 'üåπ', 'üíñ', '‚ú®'];
        function createPetal() {
            const petal = document.createElement('div');
            petal.classList.add('petal');
            
            const emoji = petalEmojis[Math.floor(Math.random() * petalEmojis.length)];
            
            petal.innerHTML = `<span class="petal-icon" style="font-size: ${Math.random() * 15 + 15}px">${emoji}</span>`;
            
            // V·ªã tr√≠ b·∫Øt ƒë·∫ßu, ƒë·ªô tr·ªÖ, v√† hi·ªáu ·ª©ng l·∫Øc l∆∞ ng·∫´u nhi√™n (s·ª≠ d·ª•ng CSS Variable)
            petal.style.left = `${Math.random() * 100}vw`;
            petal.style.animationDuration = `${Math.random() * 10 + 8}s`; 
            petal.style.animationDelay = `${Math.random() * 5}s`; 
            petal.style.setProperty('--sway', (Math.random() * 2 - 1).toFixed(2)); /* -1 ƒë·∫øn 1 cho hi·ªáu ·ª©ng l·∫Øc l∆∞ */
            
            document.body.appendChild(petal);

            // D·ªçn d·∫πp sau 20 gi√¢y ƒë·ªÉ tr√°nh tr√†n DOM
            setTimeout(() => {
                petal.remove();
            }, 20000); 
        }

        function startParticleEffect() {
            // T·∫°o m·ªôt c√°nh hoa/hi·ªáu ·ª©ng m·ªói 300ms
            if (!particleInterval) {
                particleInterval = setInterval(createPetal, 300); 
            }
        }

        function stopParticleEffect() {
            clearInterval(particleInterval);
            particleInterval = null;
            // L√†m m·ªù v√† x√≥a t·∫•t c·∫£ c√°c h·∫°t hi·ªán c√≥
            document.querySelectorAll('.petal').forEach(p => {
                p.style.transition = 'opacity 1s';
                p.style.opacity = '0';
                setTimeout(() => p.remove(), 1000);
            });
        }


        /* --- Hi·ªáu ·ª©ng Slideshow --- */
        // GI·∫¢I TH√çCH: H√†m n√†y hi·ªÉn th·ªã ·∫£nh t·∫°i v·ªã tr√≠ 'index'
        function showSlide(index) {
            slides.forEach((slide, i) => {
                // Duy·ªát qua t·∫•t c·∫£ c√°c slide
                // N·∫øu index c·ªßa slide = index c·∫ßn hi·ªÉn th·ªã ‚Üí th√™m class 'current'
                // N·∫øu kh√¥ng ‚Üí x√≥a class 'current'
                if (i === index) {
                    slide.classList.add('current');
                } else {
                    slide.classList.remove('current');
                }
            });
        }

        // GI·∫¢I TH√çCH: H√†m chuy·ªÉn sang ·∫£nh ti·∫øp theo khi click
        function nextSlide() {
            // TƒÉng currentSlide l√™n 1
            currentSlide++;
            
            // Ki·ªÉm tra: N·∫øu ƒë√£ ƒë·∫øn ·∫£nh cu·ªëi c√πng?
            if (currentSlide >= slides.length) {
                // ƒê√£ h·∫øt ·∫£nh ‚Üí Chuy·ªÉn sang stage 3 (l·ªùi ch√∫c)
                stopParticleEffect();
                handleStage3Reveal();
            } else {
                // C√≤n ·∫£nh ‚Üí Hi·ªÉn th·ªã ·∫£nh ti·∫øp theo
                showSlide(currentSlide);
            }
        }

        // GI·∫¢I TH√çCH: H√†m kh·ªüi ƒë·ªông slideshow (hi·ªÉn th·ªã ·∫£nh ƒë·∫ßu ti√™n)
        function startSlideshow() {
            // Hi·ªÉn th·ªã ·∫£nh ƒë·∫ßu ti√™n (index = 0)
            showSlide(currentSlide);
            
            // G·∫Øn s·ª± ki·ªán click v√†o container ƒë·ªÉ chuy·ªÉn ·∫£nh
            const slideshowContainer = document.getElementById('slideshow-container');
            slideshowContainer.addEventListener('click', nextSlide);
            
            // Th√™m con tr·ªè pointer ƒë·ªÉ ng∆∞·ªùi d√πng bi·∫øt c√≥ th·ªÉ click
            slideshowContainer.style.cursor = 'pointer';
        }

        /* --- Hi·ªáu ·ª©ng Typing cho L·ªùi Ch√∫c --- */
        async function typeLine(lineElement, text) {
            let i = 0;
            return new Promise(resolve => {
                const typingTimer = setInterval(() => {
                    if (i < text.length) {
                        lineElement.textContent += text.charAt(i);
                        i++;
                    } else {
                        clearInterval(typingTimer);
                        lineElement.style.borderRight = 'none'; // ·∫®n con tr·ªè sau khi g√µ xong
                        resolve();
                    }
                }, 70); // T·ªëc ƒë·ªô g√µ 70ms/k√Ω t·ª±
            });
        }

        async function startTypingEffect() {
            const typingArea = document.getElementById('typing-area');
            
            for (let i = 0; i < finalMessage.length; i++) {
                const text = finalMessage[i];
                const lineElement = document.createElement('p');
                lineElement.classList.add('message-line');
                typingArea.appendChild(lineElement);
                
                await typeLine(lineElement, text);
                
                // Gi·ªØ con tr·ªè nh·∫•p nh√°y ·ªü d√≤ng cu·ªëi c√πng
                if (i < finalMessage.length - 1) {
                    lineElement.style.borderRight = '.15em solid var(--primary-pink)';
                    await new Promise(r => setTimeout(r, 1000)); // Ch·ªù 1 gi√¢y gi·ªØa c√°c d√≤ng
                    lineElement.style.borderRight = 'none';
                }
            }
        }


        /* --- X·ª≠ l√Ω Chuy·ªÉn Giai ƒëo·∫°n Cu·ªëi --- */
        function handleStage3Reveal() {
            setStage('stage3');
            startTypingEffect();
        }

        /* --- X·ª≠ l√Ω Click ban ƒë·∫ßu (ƒëi·ªÅu ki·ªán ƒë·ªÉ ph√°t nh·∫°c) --- */
        function handleInitialClick() {
            // 1. Ph√°t nh·∫°c n·ªÅn
            audio.play().catch(e => console.error('Audio playback failed:', e));
            
            // 2. Chuy·ªÉn sang Stage 2 (Slideshow)
            setStage('stage2');
            
            // 3. K√≠ch ho·∫°t hi·ªáu ·ª©ng Particles
            startParticleEffect();

            // 4. B·∫Øt ƒë·∫ßu Slideshow
            startSlideshow();

            // G·ª° b·ªè listener sau l·∫ßn click ƒë·∫ßu ti√™n
            stage1Content.removeEventListener('click', handleInitialClick);
        }
        
        // G·∫Øn s·ª± ki·ªán click v√†o n·ªôi dung Stage 1
        stage1Content.addEventListener('click', handleInitialClick);

            // Hi·ªáu ·ª©ng hoa/th∆∞/·∫£nh r∆°i t·ª± ƒë·ªông
            // Thay c√°c ƒë∆∞·ªùng d·∫´n ·∫£nh b√™n d∆∞·ªõi b·∫±ng ·∫£nh hoa/th∆∞ b·∫°n mu·ªën
            const fallingImages = [
                '·∫¢nh/img1.jpg',
                '·∫¢nh/img2.jpg',
                '·∫¢nh/img3.jpg',
                '·∫¢nh/img4.jpg',
                '·∫¢nh/img5.jpg',
                '·∫¢nh/img6.jpg',
                '·∫¢nh/img7.jpg',
                '·∫¢nh/img8.jpg',
                '·∫¢nh/img9.jpg',
                '·∫¢nh/q3.png',
                '·∫¢nh/t2.png',
                '·∫¢nh/t5.png'

            ];

            function createFallingLetter(quantity = 3) {
                for (let i = 0; i < quantity; i++) {
                    const letter = document.createElement('img');
                    const randomImage = fallingImages[Math.floor(Math.random() * fallingImages.length)];
                    letter.src = randomImage;
                    letter.classList.add('falling-letter');
                    letter.style.left = Math.random() * (window.innerWidth - 50) + 'px';
                    document.body.appendChild(letter);
                    setTimeout(() => {
                        letter.remove();
                    }, 8000);
                }
            }

            setInterval(() => createFallingLetter(3), 600); // M·ªói 0.6 gi√¢y t·∫°o 3 ·∫£nh r∆°i

    </script>
</body>
</html>
