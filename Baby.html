<!DOCTYPE html>
<html lang="vi">
<head>
    <!--
      Baby.html â€” Trang quÃ  táº·ng 20/10 ğŸ’Œ
      PhiÃªn báº£n nÃ¢ng cáº¥p cho nhiá»u ngÆ°á»i (Chan & Linh)
    -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuÃ  Táº·ng 20/10 Äáº·c Biá»‡t ğŸ’Œ</title>
    <!-- Táº£i Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400..700&display=swap" rel="stylesheet">
    
    <!-- Link Ä‘áº¿n file CSS riÃªng -->
    <link rel="stylesheet" href="styles.css">
    
</head>
<body>

    <!-- ========================================================================= -->
    <!-- PHáº¦N HTML STRUCTURE (KhÃ´ng thay Ä‘á»•i) -->
    <!-- ========================================================================= -->

    <!-- 1. Giai Ä‘oáº¡n 1: MÃ n hÃ¬nh Prompt -->
    <div id="stage1" class="stage active">
        <div id="stage1-content">
            <p id="prompt-text">
                Tá»› cÃ³ mÃ³n quÃ  cho cáº­u nÃ¨ <span class="emoji" aria-label="lÃ¡ thÆ°">ğŸ’Œ</span>
            </p>
        </div>
    </div>

    <!-- 2. Giai Ä‘oáº¡n 2: Slideshow vÃ  Hiá»‡u á»©ng -->
    <div id="stage2" class="stage">
        <!-- JavaScript sáº½ tá»± Ä‘á»™ng chÃ¨n áº£nh vÃ o Ä‘Ã¢y -->
        <div id="slideshow-container">
        </div>
    </div>

    <!-- 3. Giai Ä‘oáº¡n 3: Lá»i ChÃºc Cuá»‘i cÃ¹ng -->
    <div id="stage3" class="stage">
        <div id="final-message-box">
            <div id="typing-area">
                <!-- Ná»™i dung sáº½ Ä‘Æ°á»£c chÃ¨n báº±ng JS -->
            </div>
            <p class="signature">â€” tá»« HÃ  Quá»‘c KhÃ¡nh â¤ï¸â¤ï¸â¤ï¸</p>
        </div>
    </div>

    <!-- Nháº¡c ná»n -->
    <audio id="bgsound" loop>
        <source src="Anhdanhroinguoiyeunay.mp3" type="audio/mp3">
    </audio>

    <!-- ========================================================================= -->
    <!-- PHáº¦N JAVASCRIPT LOGIC (ÄÃƒ Cáº¬P NHáº¬T) -->
    <!-- ========================================================================= -->
    <script>
        // --- BÆ¯á»šC 1: "DATABASE" CHá»¨A THÃ”NG TIN Tá»ªNG NGÆ¯á»œI ---
        const dataNguoiNhan = {
            
            // --- Dá»¯ liá»‡u cá»§a Chan (NgÆ°á»i yÃªu) ---
            "chan": { // Link sáº½ lÃ : ?nguoi=chan
                ten: "BÃ© Chan",
                nguoiGui: "HÃ  Quá»‘c KhÃ¡nh",
                chuKy: "â€” tá»« HÃ  Quá»‘c KhÃ¡nh â¤ï¸â¤ï¸â¤ï¸",
                prompt: "Tá»› cÃ³ mÃ³n quÃ  cho cáº­u nÃ¨ <span class=\"emoji\" aria-label=\"lÃ¡ thÆ°\">ğŸ’Œ</span>",
                loiChuc: [
                    "ChÃºc cáº­u 20/10 tháº­t ráº¡ng rá»¡, lung linh ğŸ’",
                    "ngÃ y cÃ ng xinh Ä‘áº¹p hÆ¡n ná»¯a vÃ  nhá»› cÆ°á»i nhiá»u hÆ¡n nhaaa.",
                    "Tá»« khi cáº­u xuáº¥t hiá»‡n, cuá»™c sá»‘ng cá»§a tá»› cÃ³ thÃªm nhiá»u mÃ u sáº¯c hÆ¡n  ğŸŒ¸",
                    "Cáº£m Æ¡n cáº­u Ä‘Ã£ bÆ°á»›c Ä‘áº¿n bÃªn tá»›!"
                ],
                danhSachAnh: [
                    "áº¢nh/Chan/img1.jpg",
                    "áº¢nh/Chan/img2.jpg",
                    "áº¢nh/Chan/img3.jpg",
                    "áº¢nh/Chan/img4.jpg",
                    "áº¢nh/Chan/img5.jpg",
                    "áº¢nh/Chan/img6.jpg",
                    "áº¢nh/Chan/img7.jpg",
                    "áº¢nh/Chan/img8.jpg",
                    "áº¢nh/Chan/img9.jpg"
                ]
            },
            "ngoc": { // Link sáº½ lÃ : ?nguoi=ngoc
                ten: "BÃ© Ngá»c",
                nguoiGui: "LÃª VÄƒn Ngá»c",
                chuKy: "â€” tá»« LÃª VÄƒn Ngá»c â¤ï¸",
                prompt: "Anh cÃ³ mÃ³n quÃ  cho em <span class=\"emoji\" aria-label=\"lÃ¡ thÆ°\">ğŸ’Œ</span>",
                loiChuc: [
                    "ChÃºc em 20/10 tháº­t ráº¡ng rá»¡, lung linh ğŸ’",
                    "Em mÃ£i lÃ  bÃ´ng hoa xinh Ä‘áº¹p ráº¡ng ngá»i trong cuá»™c Ä‘á»i anh.",
                    "Anh yÃªu em  ğŸŒ¸",
                    "Cáº£m Æ¡n em Ä‘Ã£ xuáº¥t hiá»‡n bÃªn anh!"
                ],
                danhSachAnh: [
                    "áº¢nh/nyngoc/nyngoc1.jpg",
                ]
            },
            
            // --- Dá»¯ liá»‡u cá»§a Linh (Em gÃ¡i) ---
            "linh": { // Link sáº½ lÃ : ?nguoi=linh
                ten: "Em gÃ¡i Linh",
                nguoiGui: "Anh KhÃ¡nh",
                chuKy: "â€” tá»« Anh KhÃ¡nh â¤ï¸â¤ï¸â¤ï¸",
                prompt: "Anh cÃ³ mÃ³n quÃ  cho em nÃ¨ <span class=\"emoji\" aria-label=\"lÃ¡ thÆ°\">ğŸ’Œ</span>",
                loiChuc: [
                    "ChÃºc em gÃ¡i 20/10 vui váº», láº¡c quan vÃ  ngÃ y cÃ ng xinh Ä‘áº¹p nhaaaa!",
                    "há»c giá»i, Ä‘áº¡t Ä‘Æ°á»£c káº¿t quáº£ mong Æ°á»›c trong ká»³",
                    "tá»‘t nghiá»‡p THPT vÃ  vÃ o Ä‘Æ°á»£c Ä‘áº¡i há»c mong Æ°á»›c",
                    "MÃ£i lÃ  cÃ´ em gÃ¡i Ä‘Ã¡ng yÃªu cá»§a anh nha! ğŸ’–"
                ],
                danhSachAnh: [
                    "áº¢nh/Linh/Linh1.jpg",
                    "áº¢nh/Linh/Linh2.jpg",
                    "áº¢nh/Linh/Linh3.jpg",
                    "áº¢nh/Linh/Linh 4.jpg"
                ]
            },
            "thu": { // Link sáº½ lÃ : ?nguoi=thu
                ten: "ban Thu",
                nguoiGui: "KhÃ¡nh",
                chuKy: "â€” tá»« KhÃ¡nh â¤ï¸â¤ï¸â¤ï¸",
                prompt: "Tá»› cÃ³ mÃ³n quÃ  cho cáº­u nÃ¨ <span class=\"emoji\" aria-label=\"lÃ¡ thÆ°\">ğŸ’Œ</span>",
                loiChuc: [
                    "ChÃºc cáº­u 20/10 tháº­t ráº¡ng rá»¡, lung linh ğŸ’",
                    "ngÃ y cÃ ng xinh Ä‘áº¹p hÆ¡n ná»¯a vÃ  nhá»› cÆ°á»i nhiá»u hÆ¡n nhaaa.",
                    "ChÃºc cáº­u Ä‘áº¡t Ä‘Æ°á»£c aim 7.5 ielts nhÃ©  ğŸŒ¸",
                    "Cáº­u luÃ´n lÃ  báº¡n tá»‘t cá»§a tá»›!"
                ],
                danhSachAnh: [
                    "áº¢nh/Thu/thu1.jpg",
                    "áº¢nh/Thu/thu2.jpg",
                    "áº¢nh/Thu/thu3.jpg",
                    "áº¢nh/Thu/thu4.jpg",
                    "áº¢nh/Thu/thu5.jpg",
                    "áº¢nh/Thu/thu6.jpg"
                ]
            },

        };


        // --- BÆ¯á»šC 2: Láº¤Y THÃ”NG TIN NGÆ¯á»œI NHáº¬N Tá»ª URL ---
        const urlParams = new URLSearchParams(window.location.search);
        const nguoiKey = urlParams.get('nguoi'); 
        
        // Chá»n data, náº¿u khÃ´ng cÃ³ key trÃªn URL thÃ¬ dÃ¹ng data cá»§a "chan" lÃ m máº·c Ä‘á»‹nh
        const thongTin = dataNguoiNhan[nguoiKey] || dataNguoiNhan['chan'];
        
        const finalMessage = thongTin.loiChuc;
        const anhCaNhan = thongTin.danhSachAnh;
        const promptText = thongTin.prompt || "Tá»› cÃ³ mÃ³n quÃ  cho cáº­u nÃ¨ <span class=\"emoji\" aria-label=\"lÃ¡ thÆ°\">ğŸ’Œ</span>";
        const fallingImages = [ ...anhCaNhan, 'áº¢nh/q3.png', 'áº¢nh/t2.png', 'áº¢nh/t5.png' ];

        // --- BÆ¯á»šC 3: CÃC BIáº¾N VÃ€ HÃ€M CÆ  Báº¢N ---
        const stage1 = document.getElementById('stage1');
        const stage2 = document.getElementById('stage2');
        const stage3 = document.getElementById('stage3');
        const stage1Content = document.getElementById('stage1-content');
        const audio = document.getElementById('bgsound');
        const slideshowContainer = document.getElementById('slideshow-container');
        const promptTextElem = document.getElementById('prompt-text');
        const signatureElem = document.querySelector('.signature');

        // GÃ¡n prompt cÃ¡ nhÃ¢n hÃ³a vÃ o pháº§n tá»­ #prompt-text
        if (promptTextElem) {
            promptTextElem.innerHTML = promptText;
        }

        // GÃ¡n chá»¯ kÃ½ cÃ¡ nhÃ¢n hÃ³a vÃ o pháº§n tá»­ .signature
        if (signatureElem && thongTin.chuKy) {
            signatureElem.textContent = thongTin.chuKy;
        }

        let slides; 
        let currentSlide = 0;
        let particleInterval;
        
        function setStage(stageId) {
            document.querySelectorAll('.stage').forEach(stage => stage.classList.remove('active'));
            document.getElementById(stageId).classList.add('active');
        }

        const petalEmojis = ['ğŸŒ¸', 'ğŸŒ¹', 'ğŸ’–', 'âœ¨'];
        function createPetal() {
            const petal = document.createElement('div');
            petal.classList.add('petal');
            const emoji = petalEmojis[Math.floor(Math.random() * petalEmojis.length)];
            petal.innerHTML = `<span class="petal-icon" style="font-size: ${Math.random() * 15 + 15}px">${emoji}</span>`;
            petal.style.left = `${Math.random() * 100}vw`;
            petal.style.animationDuration = `${Math.random() * 10 + 8}s`; 
            petal.style.animationDelay = `${Math.random() * 5}s`; 
            petal.style.setProperty('--sway', (Math.random() * 2 - 1).toFixed(2)); 
            document.body.appendChild(petal);
            setTimeout(() => { petal.remove(); }, 20000); 
        }

        function startParticleEffect() {
            if (!particleInterval) particleInterval = setInterval(createPetal, 300); 
        }

        function stopParticleEffect() {
            clearInterval(particleInterval);
            particleInterval = null;
            document.querySelectorAll('.petal').forEach(p => {
                p.style.transition = 'opacity 1s';
                p.style.opacity = '0';
                setTimeout(() => p.remove(), 1000);
            });
        }

        function taoSlideshowDong() {
            slideshowContainer.innerHTML = ''; 
            if (!anhCaNhan || anhCaNhan.length === 0) {
                slideshowContainer.innerHTML = "<p>Lá»—i: KhÃ´ng tÃ¬m tháº¥y áº£nh.</p>";
                return;
            }
            anhCaNhan.forEach((src, index) => {
                const slide = document.createElement('div');
                slide.className = 'slide' + (index === 0 ? ' current' : '');
                slide.innerHTML = `<img src="${src}" alt="áº¢nh ${index + 1}">`;
                slideshowContainer.appendChild(slide);
            });
            slideshowContainer.addEventListener('click', nextSlide);
            slideshowContainer.style.cursor = 'pointer';
        }

        function showSlide(index) {
            slides.forEach((slide, i) => {
                slide.classList.toggle('current', i === index);
            });
        }

        function nextSlide() {
            currentSlide++;
            if (currentSlide >= slides.length) {
                stopParticleEffect();
                handleStage3Reveal();
            } else {
                showSlide(currentSlide);
            }
        }

        async function typeLine(lineElement, text) {
            return new Promise(resolve => {
                let i = 0;
                const typingTimer = setInterval(() => {
                    if (i < text.length) {
                        lineElement.textContent += text.charAt(i++);
                    } else {
                        clearInterval(typingTimer);
                        lineElement.style.borderRight = 'none';
                        resolve();
                    }
                }, 70);
            });
        }

        async function startTypingEffect() {
            const typingArea = document.getElementById('typing-area');
            for (let i = 0; i < finalMessage.length; i++) {
                const lineElement = document.createElement('p');
                lineElement.className = 'message-line';
                typingArea.appendChild(lineElement);
                await typeLine(lineElement, finalMessage[i]);
                if (i < finalMessage.length - 1) {
                    lineElement.style.borderRight = '.15em solid var(--primary-pink)';
                    await new Promise(r => setTimeout(r, 1000));
                    lineElement.style.borderRight = 'none';
                }
            }
        }

        function handleStage3Reveal() {
            setStage('stage3');
            startTypingEffect();
        }

        function handleInitialClick() {
            audio.play().catch(e => console.error('Audio playback failed:', e));
            setStage('stage2');
            startParticleEffect();
            taoSlideshowDong();
            slides = document.querySelectorAll('#slideshow-container .slide');
            stage1Content.removeEventListener('click', handleInitialClick);
        }
        
        stage1Content.addEventListener('click', handleInitialClick);

        // =============================
        // HIá»†U á»¨NG áº¢NH RÆ I CÃ NHÃ‚N HÃ“A
        // =============================
        // fallingImages: Máº£ng chá»©a cÃ¡c Ä‘Æ°á»ng dáº«n áº£nh sáº½ rÆ¡i (cÃ¡ nhÃ¢n hÃ³a cho tá»«ng ngÆ°á»i)
        // Báº¡n cÃ³ thá»ƒ Ä‘á»ƒ 1 áº£nh duy nháº¥t hoáº·c nhiá»u áº£nh, miá»…n lÃ  Ä‘Ãºng Ä‘Æ°á»ng dáº«n
        // VÃ­ dá»¥: ['áº¢nh/Chan/img1.jpg'] hoáº·c ['áº¢nh/Chan/img1.jpg', 'áº¢nh/Chan/img2.jpg']

        // HÃ m táº¡o nhiá»u áº£nh rÆ¡i má»—i láº§n (quantity: sá»‘ lÆ°á»£ng áº£nh rÆ¡i/láº§n)
        function createFallingLetter(quantity = 3) {
            for (let i = 0; i < quantity; i++) {
                // Táº¡o 1 tháº» <img> cho má»—i áº£nh rÆ¡i
                const letter = document.createElement('img');
                // Chá»n ngáº«u nhiÃªn 1 áº£nh trong máº£ng fallingImages
                const randomImage = fallingImages[Math.floor(Math.random() * fallingImages.length)];
                letter.src = randomImage;
                letter.classList.add('falling-letter');
                // Äáº·t vá»‹ trÃ­ ngang ngáº«u nhiÃªn trÃªn mÃ n hÃ¬nh
                letter.style.left = Math.random() * (window.innerWidth - 50) + 'px';
                document.body.appendChild(letter);
                // Sau 8 giÃ¢y tá»± Ä‘á»™ng xÃ³a áº£nh rÆ¡i khá»i DOM Ä‘á»ƒ trÃ¡nh Ä‘áº§y bá»™ nhá»›
                setTimeout(() => { letter.remove(); }, 8000);
            }
        }

        // Tá»± Ä‘á»™ng táº¡o hiá»‡u á»©ng áº£nh rÆ¡i liÃªn tá»¥c:
        // - Má»—i 0.6 giÃ¢y sáº½ táº¡o ra 3 áº£nh rÆ¡i má»›i
        // - Muá»‘n tÄƒng/giáº£m sá»‘ lÆ°á»£ng áº£nh rÆ¡i: chá»‰nh sá»‘ 3 (sá»‘ lÆ°á»£ng) hoáº·c 600 (tá»‘c Ä‘á»™)
        setInterval(() => createFallingLetter(3), 600);
        // =============================
        // Háº¾T HIá»†U á»¨NG áº¢NH RÆ I CÃ NHÃ‚N HÃ“A
        // =============================
    </script>
</body>
</html>
