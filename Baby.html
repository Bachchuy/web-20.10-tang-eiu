<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuÃ  Táº·ng 20/10 Äáº·c Biá»‡t ğŸ’Œ</title>
    <!-- Táº£i Google Fonts: Playfair Display (cho tiÃªu Ä‘á») vÃ  Poppins (cho ná»™i dung) -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400..700&display=swap" rel="stylesheet">
    
    <!-- Link Ä‘áº¿n file CSS riÃªng -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- Preload áº£nh Ä‘á»ƒ táº£i trÆ°á»›c, giáº£m thá»i gian chá» -->
    <link rel="preload" as="image" href="áº¢nh/img1.jpg">
    <link rel="preload" as="image" href="áº¢nh/img2.jpg">
    <link rel="preload" as="image" href="áº¢nh/img3.jpg">
    <link rel="preload" as="image" href="áº¢nh/img4.jpg">
    <link rel="preload" as="image" href="áº¢nh/img5.jpg">
    
</head>
<body>

    <!-- ========================================================================= -->
    <!-- PHáº¦N HTML STRUCTURE -->
    <!-- ========================================================================= -->

    <!-- 1. Giai Ä‘oáº¡n 1: MÃ n hÃ¬nh Prompt -->
    <div id="stage1" class="stage active">
        <div id="stage1-content">
            <p id="prompt-text">
                Tá»› cÃ³ mÃ³n quÃ  cho cáº­u nÃ¨ ğŸ’Œ
            </p>
        </div>
    </div>

    <!-- 2. Giai Ä‘oáº¡n 2: Slideshow vÃ  Hiá»‡u á»©ng -->
    <div id="stage2" class="stage">
        <div id="slideshow-container">
            <!-- CHÃš Ã: Thay tháº¿ cÃ¡c URL placeholder nÃ y báº±ng áº£nh cá»§a ngÆ°á»i yÃªu báº¡n -->
            <div class="slide current"><img src="áº¢nh/img1.jpg" alt="áº¢nh 1"></div>
            <div class="slide"><img src="áº¢nh/img2.jpg" alt="áº¢nh 2"></div>
            <div class="slide"><img src="áº¢nh/img3.jpg" alt="áº¢nh 3"></div>
            <div class="slide"><img src="áº¢nh/img4.jpg" alt="áº¢nh 4"></div>
            <div class="slide"><img src="áº¢nh/img5.jpg" alt="áº¢nh 5"></div>

            <img src="áº¢nh/img2.jpg" alt="áº¢nh 2">
    
        </div>
    </div>

    <!-- 3. Giai Ä‘oáº¡n 3: Lá»i ChÃºc Cuá»‘i cÃ¹ng -->
    <div id="stage3" class="stage">
        <div id="final-message-box">
            <div id="typing-area">
                <!-- Ná»™i dung sáº½ Ä‘Æ°á»£c chÃ¨n báº±ng JS -->
            </div>
            <p class="signature">â€” tá»« HÃ  Quá»‘c KhÃ¡nh â¤ï¸â¤ï¸â¤ï¸</p>
        </div>
    </div>

    <!-- Nháº¡c ná»n (Sáº½ Ä‘Æ°á»£c phÃ¡t báº±ng JS sau khi click) -->
    <audio id="bgsound" loop>
        <!-- THAY THáº¾ DÃ’NG NÃ€Y Báº°NG LINK MP3 Cá»¦A Báº N -->
        <source src="Anhdanhroinguoiyeunay.mp3" type="audio/mp3">
    </audio>

    <!-- ========================================================================= -->
    <!-- PHáº¦N JAVASCRIPT LOGIC -->
    <!-- Sá»­ dá»¥ng JS Ä‘á»ƒ Ä‘iá»u khiá»ƒn tÆ°Æ¡ng tÃ¡c vÃ  thá»i gian -->
    <!-- ========================================================================= -->
    <script>
        const stage1 = document.getElementById('stage1');
        const stage2 = document.getElementById('stage2');
        const stage3 = document.getElementById('stage3');
        const stage1Content = document.getElementById('stage1-content');
        const audio = document.getElementById('bgsound');
        const slides = document.querySelectorAll('#slideshow-container .slide');
        let currentSlide = 0;
        let slideshowInterval;
        let particleInterval;

        // Lá»i chÃºc cuá»‘i cÃ¹ng
        const finalMessage = [
            "ChÃºc cáº­u 20/10 tháº­t ráº¡ng rá»¡, lung linh ğŸ’",
            "ngÃ y cÃ ng xinh Ä‘áº¹p hÆ¡n ná»¯a vÃ  nhá»› cÆ°á»i nhiá»u hÆ¡n nhaaa.",
            "Tá»« khi cáº­u xuáº¥t hiá»‡n, cuá»™c sá»‘ng cá»§a tá»› cÃ³ thÃªm nhiá»u mÃ u sáº¯c hÆ¡n  ğŸŒ¸",
            "Cáº£m Æ¡n cáº­u Ä‘Ã£ bÆ°á»›c Ä‘áº¿n bÃªn tá»›!"
        ];

        /* --- HÃ m Xá»­ lÃ½ Chuyá»ƒn Stage (Stage Manager) --- */
        function setStage(stageId) {
            document.querySelectorAll('.stage').forEach(stage => {
                stage.classList.remove('active');
            });
            document.getElementById(stageId).classList.add('active');
        }

        /* --- Hiá»‡u á»©ng Hoa RÆ¡i (Petal Particles) --- */
        const petalEmojis = ['ğŸŒ¸', 'ğŸŒ¹', 'ğŸ’–', 'âœ¨'];
        function createPetal() {
            const petal = document.createElement('div');
            petal.classList.add('petal');
            
            const emoji = petalEmojis[Math.floor(Math.random() * petalEmojis.length)];
            
            petal.innerHTML = `<span class="petal-icon" style="font-size: ${Math.random() * 15 + 15}px">${emoji}</span>`;
            
            // Vá»‹ trÃ­ báº¯t Ä‘áº§u, Ä‘á»™ trá»…, vÃ  hiá»‡u á»©ng láº¯c lÆ° ngáº«u nhiÃªn (sá»­ dá»¥ng CSS Variable)
            petal.style.left = `${Math.random() * 100}vw`;
            petal.style.animationDuration = `${Math.random() * 10 + 8}s`; 
            petal.style.animationDelay = `${Math.random() * 5}s`; 
            petal.style.setProperty('--sway', (Math.random() * 2 - 1).toFixed(2)); /* -1 Ä‘áº¿n 1 cho hiá»‡u á»©ng láº¯c lÆ° */
            
            document.body.appendChild(petal);

            // Dá»n dáº¹p sau 20 giÃ¢y Ä‘á»ƒ trÃ¡nh trÃ n DOM
            setTimeout(() => {
                petal.remove();
            }, 20000); 
        }

        function startParticleEffect() {
            // Táº¡o má»™t cÃ¡nh hoa/hiá»‡u á»©ng má»—i 300ms
            if (!particleInterval) {
                particleInterval = setInterval(createPetal, 300); 
            }
        }

        function stopParticleEffect() {
            clearInterval(particleInterval);
            particleInterval = null;
            // LÃ m má» vÃ  xÃ³a táº¥t cáº£ cÃ¡c háº¡t hiá»‡n cÃ³
            document.querySelectorAll('.petal').forEach(p => {
                p.style.transition = 'opacity 1s';
                p.style.opacity = '0';
                setTimeout(() => p.remove(), 1000);
            });
        }


        /* --- Hiá»‡u á»©ng Slideshow --- */
        // GIáº¢I THÃCH: HÃ m nÃ y hiá»ƒn thá»‹ áº£nh táº¡i vá»‹ trÃ­ 'index'
        function showSlide(index) {
            slides.forEach((slide, i) => {
                // Duyá»‡t qua táº¥t cáº£ cÃ¡c slide
                // Náº¿u index cá»§a slide = index cáº§n hiá»ƒn thá»‹ â†’ thÃªm class 'current'
                // Náº¿u khÃ´ng â†’ xÃ³a class 'current'
                if (i === index) {
                    slide.classList.add('current');
                } else {
                    slide.classList.remove('current');
                }
            });
        }

        // GIáº¢I THÃCH: HÃ m chuyá»ƒn sang áº£nh tiáº¿p theo khi click
        function nextSlide() {
            // TÄƒng currentSlide lÃªn 1
            currentSlide++;
            
            // Kiá»ƒm tra: Náº¿u Ä‘Ã£ Ä‘áº¿n áº£nh cuá»‘i cÃ¹ng?
            if (currentSlide >= slides.length) {
                // ÄÃ£ háº¿t áº£nh â†’ Chuyá»ƒn sang stage 3 (lá»i chÃºc)
                stopParticleEffect();
                handleStage3Reveal();
            } else {
                // CÃ²n áº£nh â†’ Hiá»ƒn thá»‹ áº£nh tiáº¿p theo
                showSlide(currentSlide);
            }
        }

        // GIáº¢I THÃCH: HÃ m khá»Ÿi Ä‘á»™ng slideshow (hiá»ƒn thá»‹ áº£nh Ä‘áº§u tiÃªn)
        function startSlideshow() {
            // Hiá»ƒn thá»‹ áº£nh Ä‘áº§u tiÃªn (index = 0)
            showSlide(currentSlide);
            
            // Gáº¯n sá»± kiá»‡n click vÃ o container Ä‘á»ƒ chuyá»ƒn áº£nh
            const slideshowContainer = document.getElementById('slideshow-container');
            slideshowContainer.addEventListener('click', nextSlide);
            
            // ThÃªm con trá» pointer Ä‘á»ƒ ngÆ°á»i dÃ¹ng biáº¿t cÃ³ thá»ƒ click
            slideshowContainer.style.cursor = 'pointer';
        }

        /* --- Hiá»‡u á»©ng Typing cho Lá»i ChÃºc --- */
        async function typeLine(lineElement, text) {
            let i = 0;
            return new Promise(resolve => {
                const typingTimer = setInterval(() => {
                    if (i < text.length) {
                        lineElement.textContent += text.charAt(i);
                        i++;
                    } else {
                        clearInterval(typingTimer);
                        lineElement.style.borderRight = 'none'; // áº¨n con trá» sau khi gÃµ xong
                        resolve();
                    }
                }, 70); // Tá»‘c Ä‘á»™ gÃµ 70ms/kÃ½ tá»±
            });
        }

        async function startTypingEffect() {
            const typingArea = document.getElementById('typing-area');
            
            for (let i = 0; i < finalMessage.length; i++) {
                const text = finalMessage[i];
                const lineElement = document.createElement('p');
                lineElement.classList.add('message-line');
                typingArea.appendChild(lineElement);
                
                await typeLine(lineElement, text);
                
                // Giá»¯ con trá» nháº¥p nhÃ¡y á»Ÿ dÃ²ng cuá»‘i cÃ¹ng
                if (i < finalMessage.length - 1) {
                    lineElement.style.borderRight = '.15em solid var(--primary-pink)';
                    await new Promise(r => setTimeout(r, 1000)); // Chá» 1 giÃ¢y giá»¯a cÃ¡c dÃ²ng
                    lineElement.style.borderRight = 'none';
                }
            }
        }


        /* --- Xá»­ lÃ½ Chuyá»ƒn Giai Ä‘oáº¡n Cuá»‘i --- */
        function handleStage3Reveal() {
            setStage('stage3');
            startTypingEffect();
        }

        /* --- Xá»­ lÃ½ Click ban Ä‘áº§u (Ä‘iá»u kiá»‡n Ä‘á»ƒ phÃ¡t nháº¡c) --- */
        function handleInitialClick() {
            // 1. PhÃ¡t nháº¡c ná»n
            audio.play().catch(e => console.error('Audio playback failed:', e));
            
            // 2. Chuyá»ƒn sang Stage 2 (Slideshow)
            setStage('stage2');
            
            // 3. KÃ­ch hoáº¡t hiá»‡u á»©ng Particles
            startParticleEffect();

            // 4. Báº¯t Ä‘áº§u Slideshow
            startSlideshow();

            // Gá»¡ bá» listener sau láº§n click Ä‘áº§u tiÃªn
            stage1Content.removeEventListener('click', handleInitialClick);
        }
        
        // Gáº¯n sá»± kiá»‡n click vÃ o ná»™i dung Stage 1
        stage1Content.addEventListener('click', handleInitialClick);

    </script>
</body>
</html>
